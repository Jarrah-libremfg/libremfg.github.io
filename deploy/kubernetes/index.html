<!doctype html><html lang=en class="js csstransforms3d"><head><script>var subPaths={"/deploy/#install-dgraph":"/deploy/download","/deploy/#docker":"/deploy/download/#docker","/deploy/#automatic-download":"/deploy/download/#automatic-download","/deploy/#manual-download-[optional]":"/deploy/download/#manual-download-[optional]","/deploy/#building-from-source":"/deploy/download/#building-from-source","/deploy/#understanding-dgraph-cluster":"/deploy/cluster-setup/#understanding-dgraph-cluster","/deploy/#sharding":"/deploy/cluster-setup/#sharding","/deploy/#shard-rebalancing":"/deploy/cluster-setup/#shard-rebalancing","/deploy/#consistent-replication":"/deploy/cluster-setup/#consistent-replication","/deploy/#types-of-ports":"/deploy/ports-usage/#types-of-ports","/deploy/#ports-used-by-different-nodes":"/deploy/ports-usage/#ports-used-by-different-nodes","/deploy/#ha-cluster-setup":"/deploy/ports-usage/#ha-cluster-setup","/deploy/#dgraph-zero":"/deploy/ports-usage/#dgraph-zero","/deploy/#dgraph-alpha":"/deploy/ports-usage/#dgraph-alpha","/deploy/#run-directly-on-the-host":"/deploy/single-host-setup/#run-directly-on-the-host","/deploy/#run-dgraph-zero":"/deploy/single-host-setup/#run-dgraph-zero","/deploy/#run-dgraph-alpha":"/deploy/single-host-setup/#run-dgraph-alpha","/deploy/#run-dgraph-ui":"/deploy/single-host-setup/#run-dgraph-ui","/deploy/#run-using-docker":"/deploy/single-host-setup/#run-using-docker","/deploy/#create-docker-network":"/deploy/single-host-setup/#create-docker-network","/deploy/#run-dgraph-zero":"/deploy/single-host-setup/#run-dgraph-zero","/deploy/#run-dgraph-alpha":"/deploy/single-host-setup/#run-dgraph-alpha","/deploy/#run-dgraph-ui":"/deploy/single-host-setup/#run-dgraph-ui","/deploy/#run-using-docker-compose-(on-single-aws-instance)":"/deploy/single-host-setup/#run-using-docker-compose-(on-single-aws-instance)","/deploy/#using-docker-swarm":"/deploy/multi-host-setup/#using-docker-swarm","/deploy/#cluster-setup-using-docker-swarm":"/deploy/multi-host-setup/#cluster-setup-using-docker-swarm","/deploy/#ha-cluster-setup-using-docker-swarm":"/deploy/multi-host-setup/#ha-cluster-setup-using-docker-swarm","/deploy/#single-server":"/deploy/kubernetes/#single-server","/deploy/#deploy-single-server":"/deploy/kubernetes/#deploy-single-server","/deploy/#verify-single-server":"/deploy/kubernetes/#verify-single-server","/deploy/#test-single-server-setup":"/deploy/kubernetes/#test-single-server-setup","/deploy/#remove-single-server-resources":"/deploy/kubernetes/#remove-single-server-resources","/deploy/#ha-cluster-setup-using-kubernetes":"/deploy/kubernetes/#ha-cluster-setup-using-kubernetes","/deploy/#validate-kubernetes-cluster-for-ha":"/deploy/kubernetes/#validate-kubernetes-cluster-for-ha","/deploy/#verify-dgraph-ha-cluster":"/deploy/kubernetes/#verify-dgraph-ha-cluster","/deploy/#test-dgraph-ha-cluster-setup":"/deploy/kubernetes/#test-dgraph-ha-cluster-setup","/deploy/#delete-dgraph-ha-cluster-resources":"/deploy/kubernetes/#delete-dgraph-ha-cluster-resources","/deploy/#using-helm-chart":"/deploy/kubernetes/#using-helm-chart","/deploy/#installing-the-chart":"/deploy/kubernetes/#installing-the-chart","/deploy/#upgrading-the-chart":"/deploy/kubernetes/#upgrading-the-chart","/deploy/#deleting-the-chart":"/deploy/kubernetes/#deleting-the-chart","/deploy/#configuration":"/deploy/kubernetes/#configuration","/deploy/#monitoring-in-kubernetes":"/deploy/kubernetes/#monitoring-in-kubernetes","/deploy/#kubernetes-storage":"/deploy/kubernetes/#kubernetes-storage","/deploy/#local-storage":"/deploy/kubernetes/#local-storage","/deploy/#non-local-persistent-disks":"/deploy/kubernetes/#non-local-persistent-disks","/deploy/#removing-a-dgraph-pod":"/deploy/kubernetes/#removing-a-dgraph-pod","/deploy/#kubernetes-and-bulk-loader":"/deploy/kubernetes/#kubernetes-and-bulk-loader","/deploy/#more-about-dgraph-alpha":"/deploy/dgraph-alpha","/deploy/#querying-health":"/deploy/dgraph-alpha/#querying-health","/deploy/#more-about-dgraph-zero":"/deploy/dgraph-zero","/deploy/#more-about-state-endpoint":"/deploy/dgraph-zero/#more-about-state-endpoint","/deploy/#query-logging":"/deploy/log-format/#query-logging","/deploy/#dgraph-certificate-management-tool":"/deploy/tls-configuration/#dgraph-certificate-management-tool","/deploy/#file-naming-conventions":"/deploy/tls-configuration/#file-naming-conventions","/deploy/#certificate-inspection":"/deploy/tls-configuration/#certificate-inspection","/deploy/#tls-options":"/deploy/tls-configuration/#tls-options","/deploy/#using-tls-without-client-authentication":"/deploy/tls-configuration/#using-tls-without-client-authentication","/deploy/#using-tls-with-client-authentication":"/deploy/tls-configuration/#using-tls-with-client-authentication","/deploy/#client-authentication-options":"/deploy/tls-configuration/#client-authentication-options","/deploy/#using-ratel-ui-with-client-authentication":"/deploy/tls-configuration/#using-ratel-ui-with-client-authentication","/deploy/#using-curl-with-client-authentication":"/deploy/tls-configuration/#using-curl-with-client-authentication","/deploy/#access-data-using-a-client":"/deploy/tls-configuration/#access-data-using-a-client","/deploy/#troubleshooting-ratel-s-client-authentication":"/deploy/tls-configuration/#troubleshooting-ratel-s-client-authentication","/deploy/#live-loader":"/deploy/fast-data-loading/#live-loader","/deploy/#encrypted-imports-via-live-loader":"/deploy/fast-data-loading/#encrypted-imports-via-live-loader","/deploy/#encrypted-rdf-json-file-and-schema-via-live-loader":"/deploy/fast-data-loading/#encrypted-rdf-json-file-and-schema-via-live-loader","/deploy/#other-live-loader-options":"/deploy/fast-data-loading/#other-live-loader-options","/deploy/#bulk-loader":"/deploy/fast-data-loading/#bulk-loader","/deploy/#encryption-at-rest-with-bulk-loader":"/deploy/fast-data-loading/#encryption-at-rest-with-bulk-loader","/deploy/#encrypting-imports-via-bulk-loader":"/deploy/fast-data-loading/#encrypting-imports-via-bulk-loader","/deploy/#other-bulk-loader-options":"/deploy/fast-data-loading/#other-bulk-loader-options","/deploy/#tuning-monitoring":"/deploy/fast-data-loading/#tuning-monitoring","/deploy/#disk-metrics":"/deploy/metrics/#disk-metrics","/deploy/#memory-metrics":"/deploy/metrics/#memory-metrics","/deploy/#activity-metrics":"/deploy/metrics/#activity-metrics","/deploy/#health-metrics":"/deploy/metrics/#health-metrics","/deploy/#go-metrics":"/deploy/metrics/#go-metrics","/deploy/#examining-traces-with-zpages":"/deploy/tracing/#examining-traces-with-zpages","/deploy/#examining-traces-with-jaeger":"/deploy/tracing/#examining-traces-with-jaeger","/deploy/#setting-up-multiple-dgraph-clusters-with-jaeger":"/deploy/tracing/#setting-up-multiple-dgraph-clusters-with-jaeger","/deploy/#whitelisting-admin-operations":"/deploy/dgraph-administration/#whitelisting-admin-operations","/deploy/#restricting-mutation-operations":"/deploy/dgraph-administration/#restricting-mutation-operations","/deploy/#securing-alter-operations":"/deploy/dgraph-administration/#securing-alter-operations","/deploy/#export-database":"/deploy/dgraph-administration/#exporting-database","/deploy/#encrypting-exports":"/deploy/dgraph-administration/#encrypting-exports","/deploy/#shutting-down-database":"/deploy/dgraph-administration/#shutting-down-database","/deploy/#deleting-database":"/deploy/dgraph-administration/#deleting-database","/deploy/#upgrading-database":"/deploy/dgraph-administration/#upgrading-database","/deploy/#upgrading-from-v1-2-2-to-v20-03-0-for-enterprise-customers":"/deploy/dgraph-administration/#upgrading-from-v1-2-2-to-v20-03-0-for-enterprise-customers","/deploy/#post-installation":"/deploy/dgraph-administration/#post-installation","/deploy/#running-oom-out-of-memory":"/deploy/troubleshooting/#running-oom-out-of-memory","/deploy/#too-many-open-files":"/deploy/troubleshooting/#too-many-open-files","/deploy/#cluster-requirements":"/deploy/production-checklist/#cluster-requirements","/deploy/#machine-requirements":"/deploy/production-checklist/#machine-requirements","/deploy/#operating-system":"/deploy/production-checklist/#operating-system","/deploy/#cpu-and-memory":"/deploy/production-checklist/#cpu-and-memory","/deploy/#disk":"/deploy/production-checklist/#disk","/deploy/#firewall-rules":"/deployproduction-checklist/#firewall-rules","/deploy/#operating-system-tuning":"/deploy/production-checklist/#operating-system-tuning","/deploy/#deployment":"/deploy/production-checklist/#deployment","/deploy/#terminology":"/deploy/production-checklist/#terminology","/deploy/#basic-setup-2-node-cluster":"/deploy/production-checklist/#basic-setup-2-node-cluster","/deploy/#ha-setup-6-node-cluster":"/deploy/production-checklist/#ha-setup-6-node-cluster","/deploy/#supplementary-services":"/deploy/production-checklist/#supplementary-services","/deploy/#see-also":"/deploy/","/query-language/#take-a-tour-https-tour-dgraph-io":"/query-language/graphql-fundamentals/#take-a-tour-https-tour-dgraph-io","/query-language/#running-examples":"/query-language/graphql-fundamentals/#running-examples","/query-language/#graphql-fundamentals":"/query-language/graphql-fundamentals/#graphql-fundamentals","/query-language/#returning-values":"/query-language/graphql-fundamentals/#returning-values","/query-language/#expanding-graph-edges":"/query-language/graphql-fundamentals/#expanding-graph-edges","/query-language/#comments":"/query-language/graphql-fundamentals/#comments","/query-language/#applying-filters":"/query-language/graphql-fundamentals/#applying-filters","/query-language/#language-support":"/query-language/graphql-fundamentals/#language-support","/query-language/#functions":"/query-language/functions","/query-language/#term-matching":"/query-language/functions/#term-matching","/query-language/#allofterms":"/query-language/functions/#allofterms","/query-language/#usage-at-root":"/query-language/functions/#usage-at-root","/query-language/#usage-as-filter":"/query-language/functions/#usage-as-filter","/query-language/#anyofterms":"/query-language/functions/#anyofterms","/query-language/#usage-at-root-1":"/query-language/functions/#usage-at-root-1","/query-language/#usage-as-filter-1":"/query-language/functions/#usage-as-filter-1","/query-language/#regular-expressions":"/query-language/functions/#regular-expressions","/query-language/#technical-details":"/query-language/functions/#technical-details","/query-language/#writing-efficient-regular-expressions-and-limitations":"/query-language/functions/#writing-efficient-regular-expressions-and-limitations","/query-language/#fuzzy-matching":"/query-language/functions/#fuzzy-matching","/query-language/#full-text-search":"/query-language/functions/#full-text-search","/query-language/#inequality":"/query-language/functions/#inequality","/query-language/#equal-to":"/query-language/functions/#equal-to","/query-language/#less-than-less-than-or-equal-to-greater-than-and-greater-than-or-equal-to":"/query-language/functions/#less-than-less-than-or-equal-to-greater-than-and-greater-than-or-equal-to","/query-language/#uid":"/query-language/functions/#uid","/query-language/#uid-in":"/query-language/functions/#uid-in","/query-language/#has":"/query-language/functions/#has","/query-language/#geolocation":"/query-language/functions/#geolocation","/query-language/#mutations":"/query-language/functions/#mutations","/query-language/#query":"/query-language/functions/#query","/query-language/#near":"/query-language/functions/#near","/query-language/#within":"/query-language/functions/#within","/query-language/#contains":"/query-language/functions/#contains","/query-language/#intersects":"/query-language/functions/#intersects","/query-language/#connecting-filters":"/query-language/connecting-filters/","/query-language/#and-or-and-not":"/query-language/connecting-filters/#and-or-and-not","/query-language/#alias":"/query-language/alias","/query-language/#pagination":"/query-language/pagination","/query-language/#first":"/query-language/pagination/#first","/query-language/#offset":"/query-language/paginatio/n#offset","/query-language/#after":"/query-language/pagination/#after","/query-language/#count":"/query-language/count","/query-language/#sorting":"/query-language/sorting","/query-language/#multiple-query-blocks":"/query-language/multiple-query-blocks","/query-language/#var-blocks":"/query-language/multiple-query-blocks/#var-blocks","/query-language/#query-variables":"/query-language/query-variables/","/query-language/#value-variables":"/query-language/value-variables/","/query-language/#variable-propagation":"/query-language/value-variables/#variable-propagation","/query-language/#aggregation":"/query-language/aggregation/","/query-language/#min":"/query-language/aggregation/#min","/query-language/#usage-at-root-2":"/query-language/aggregation/#usage-at-root-2","/query-language/#usage-at-other-levels":"/query-language/aggregation/#usage-at-other-levels","/query-language/#max":"/query-language/aggregation/#max","/query-language/#usage-at-root-3":"/query-language/aggregation/#usage-at-root-3","/query-language/#usage-at-other-levels-1":"/query-language/aggregation/#usage-at-other-levels-1","/query-language/#sum-and-avg":"/query-language/aggregation/#sum-and-avg","/query-language/#usage-at-root-4":"/query-language/aggregation/#usage-at-root-4","/query-language/#usage-at-other-levels-2":"/query-language/aggregation/#usage-at-other-levels-2","/query-language/#aggregating-aggregates":"/query-language/aggregation/#aggregating-aggregates","/query-language/#math-on-value-variables":"/query-language/math-on-value-variables/","/query-language/#groupby":"/query-language/groupby/","/query-language/#expand-predicates":"/query-language/expand-predicates/","/query-language/#filtering-during-expand":"/query-language/expand-predicates/#filtering-during-expand","/query-language/#cascade-directive":"/query-language/cascade-directive/","/query-language/#normalize-directive":"/query-language/normalize-directive/","/query-language/#ignorereflex-directive":"/query-language/ignorereflex-directive/","/query-language/#debug":"/query-language/debug/","/query-language/#schema":"/query-language/schema/","/query-language/#schema-types":"/query-language/schema/#schema-types","/query-language/#scalar-types":"/query-language/schema/#scalar-types","/query-language/#uid-type":"/query-language/schema/#uid-type","/query-language/#adding-or-modifying-schema":"/query-language/schema/#adding-or-modifying-schema","/query-language/#indexes-in-background":"/query-language/schema/#indexes-in-background","/query-language/#http-api":"/query-language/schema/#http-api","/query-language/#grpc-api":"/query-language/schema/#grpc-api","/query-language/#predicate-name-rules":"/query-language/schema/#predicate-name-rules","/query-language/#allowed-special-characters":"/query-language/schema/#allowed-special-characters","/query-language/#forbidden-special-characters":"/query-language/schema/#forbidden-special-characters","/query-language/#predicates-i18n":"/query-language/schema/#predicates-i18n","/query-language/#upsert-directive":"/query-language/schema/#upsert-directive","/query-language/#noconflict-directive":"/query-language/schema/#noconflict-directive","/query-language/#rdf-types":"/query-language/schema/#rdf-types","/query-language/#extended-types":"/query-language/schema/#extended-types","/query-language/#password-type":"/query-language/schema/#password-type","/query-language/#indexing":"/query-language/schema/#indexing","/query-language/#string-indices":"/query-language/schema/#string-indices","/query-language/#datetime-indices":"/query-language/schema/#datetime-indices","/query-language/#sortable-indices":"/query-language/schema/#sortable-indices","/query-language/#count-index":"/query-language/schema/#count-index","/query-language/#list-type":"/query-language/schema/#list-type","/query-language/#filtering-on-list":"/query-language/schema/#filtering-on-list","/query-language/#reverse-edges":"/query-language/schema/#reverse-edges","/query-language/#querying-schema":"/query-language/schema/#querying-schema","/query-language/#type-system":"/query-language/type-system/","/query-language/#type-definition":"/query-language/schema/#type-definition","/query-language/#setting-the-type-of-a-node":"/query-language/schema/#setting-the-type-of-a-node","/query-language/#using-types-during-queries":"/query-language/schema/#using-types-during-queries","/query-language/#deleting-a-type":"/query-language/schema/#deleting-a-type","/query-language/#expand-queries-and-types":"/query-language/schema/#expand-queries-and-types","/query-language/#facets-edge-attributes":"/query-language/facets/","/query-language/#facets-on-scalar-predicates":"/query-language/facets/#facets-on-scalar-predicates","/query-language/#facets-i18n":"/query-language/facets/#facets-i18n","/query-language/#alias-with-facets":"/query-language/facets/#alias-with-facets","/query-language/#facets-on-uid-predicates":"/query-language/facets/#facets-on-uid-predicates","/query-language/#filtering-on-facets":"/query-language/facets/#filtering-on-facets","/query-language/#sorting-using-facets":"/query-language/facets/#sorting-using-facets","/query-language/#assigning-facet-values-to-a-variable":"/query-language/facets/#assigning-facet-values-to-a-variable","/query-language/#facets-and-variable-propagation":"/query-language/facets/#facets-and-variable-propagation","/query-language/#facets-and-aggregation":"/query-language/facets/#facets-and-aggregation","/query-language/#k-shortest-path-queries":"/query-language/k-shortest-path-queries/","/query-language/#recurse-query":"/query-language/recurse-query/","/query-language/#fragments":"/query-language/fragments/","/query-language/#graphql-variables":"/query-language/graphql-variables/","/query-language/#indexing-with-custom-tokenizers":"/query-language/indexing-custom-tokenizers/","/query-language/#caveats":"/query-language/indexing-custom-tokenizers/#caveats","/query-language/#implementing-a-plugin":"/query-language/indexing-custom-tokenizers/#implementing-a-plugin","/query-language/#building-the-plugin":"/query-language/indexing-custom-tokenizers/#building-the-plugin","/query-language/#running-dgraph-with-plugins":"/query-language/indexing-custom-tokenizers/#running-dgraph-with-plugins","/query-language/#adding-the-index-to-the-schema":"/query-language/indexing-custom-tokenizers/#adding-the-index-to-the-schema","/query-language/#using-the-index-in-queries":"/query-language/indexing-custom-tokenizers/#using-the-index-in-queries","/query-language/#examples":"/query-language/indexing-custom-tokenizers/#examples","/query-language/#unicode-characters":"/query-language/indexing-custom-tokenizers/#unicode-characters","/query-language/#cidr-range":"/query-language/indexing-custom-tokenizers/#cidr-range","/query-language/#anagram":"/query-language/indexing-custom-tokenizers/#anagram","/query-language/#integer-prime-factors":"/query-language/indexing-custom-tokenizers/#integer-prime-factors","/design-concepts/#can-we-do-pre-writes-only-on-leaders":"/design-concepts/transactions-faq/","/design-concepts/#edges":"/design-concepts/concepts/#edges","/design-concepts/#posting-list":"/design-concepts/concepts/#posting-list","/design-concepts/#badger":"/design-concepts/concepts/#badger","/design-concepts/#group":"/design-concepts/concepts/#group","/design-concepts/#replication-and-server-failure":"/design-concepts/concepts/#replication-and-server-failure","/design-concepts/#new-server-and-discovery":"/design-concepts/concepts/#new-server-and-discovery","/design-concepts/#write-ahead-logs":"/design-concepts/concepts/#write-ahead-logs","/design-concepts/#mutations":"/design-concepts/concepts/#mutations","/design-concepts/#queries":"/design-concepts/concepts/#queries","/design-concepts/#network-calls":"/design-concepts/concepts/#network-calls","/design-concepts/#worker":"/design-concepts/concepts/#worker","/design-concepts/#worker-pool":"/design-concepts/concepts/#worker-pool","/design-concepts/#protocol-buffers":"/design-concepts/concepts/#protocol-buffers","/design-concepts/#sql-nosql":"/design-concepts/minimizing-network-calls/#sql-nosql","/design-concepts/#dgraph":"/design-concepts/minimizing-network-calls/#dgraph","/design-concepts/#term":"/design-concepts/raft/#dgraph","/design-concepts/#server-states":"/design-concepts/raft/#server-states","/design-concepts/#communication":"/design-concepts/raft/#communication","/design-concepts/#log-entries":"/design-concepts/raft/#log-entries","/design-concepts/#voting":"/design-concepts/raft/#voting","/design-concepts/#cluster-membership":"/design-concepts/raft/#cluster-membership","/design-concepts/#log-compaction":"/design-concepts/raft/#log-compaction","/design-concepts/#clients":"/design-concepts/raft/#clients","/design-concepts/#linearizable-semantics":"/design-concepts/raft/#linearizable-semantics","/design-concepts/#read-only-queries":"/design-concepts/raft/#read-only-queries","/mutations/#deletion-of-non-list-predicates":"/mutations/delete/#deletion-of-non-list-predicates","/mutations/#setting-literal-values":"/mutations/json-mutation-format/#setting-literal-values","/mutations/#language-support":"/mutations/json-mutation-format/#language-support","/mutations/#geolocation-support":"/mutations/json-mutation-format/#geolocation-support","/mutations/#referencing-existing-nodes":"/mutations/json-mutation-format/#referencing-existing-nodes","/mutations/#edges-between-nodes":"/mutations/json-mutation-format/#edges-between-nodes","/mutations/#deleting-literal-values":"/mutations/json-mutation-format/#deleting-literal-values","/mutations/#deleting-edges":"/mutations/json-mutation-format/#deleting-edges","/mutations/#facets":"/mutations/json-mutation-format/#facets","/mutations/#deleting-facets":"/mutations/json-mutation-format/#deleting-facets","/mutations/#creating-a-list-with-json-and-interacting-with":"/mutations/json-mutation-format/#creating-a-list-with-json-and-interacting-with","/mutations/#facets-in-list-type-with-json":"/mutations/json-mutation-format/#facets-in-list-type-with-json","/mutations/#specifying-multiple-operations":"/mutations/json-mutation-format/#specifying-multiple-operations","/mutations/#json-syntax-using-raw-http-or-ratel-ui":"/mutations/json-mutation-format/#json-syntax-using-raw-http-or-ratel-ui","/mutations/#using-json-operations-via-curl":"/mutations/json-mutation-format/#using-json-operations-via-curl","/mutations/#uid-function":"/mutations/upsert-block/#uid-function","/mutations/#val-function":"/mutations/upsert-block/#val-function","/mutations/#example-of-uid-function":"/mutations/upsert-block/#example-of-uid-function","/mutations/#example-of-val-function":"/mutations/upsert-block/#example-of-val-function","/mutations/#bulk-delete-example":"/mutations/upsert-block/#bulk-delete-example","/mutations/#example-of-conditional-upsert":"/mutations/conditional-upsert/#example-of-conditional-upsert","/mutations/#example-of-multiple-mutation-blocks":"/mutations/conditional-upsert/#example-of-multiple-mutation-blocks","/enterprise-features/#configure-backup":"/enterprise-features/binary-backups/#configure-backup","/enterprise-features/#configure-amazon-s3-credentials":"/enterprise-features/binary-backups/#configure-amazon-s3-credentials","/enterprise-features/#configure-minio-credentials":"/enterprise-features/binary-backups/#configure-minio-credentials","/enterprise-features/#create-a-backup":"/enterprise-features/binary-backups/#create-a-backup","/enterprise-features/#backup-to-amazon-s3":"/enterprise-features/binary-backups/#backup-to-amazon-s3","/enterprise-features/#backup-to-minio":"/enterprise-features/binary-backups/#backup-to-minio","/enterprise-features/#backup-to-minio":"/enterprise-features/binary-backups/#backup-to-minio","/enterprise-features/#backup-to-google-cloud-storage-via-minio-gateway":"/enterprise-features/binary-backups/#backup-to-google-cloud-storage-via-minio-gateway","/enterprise-features/#test-using-minio-browser":"/enterprise-features/binary-backups/#test-using-minio-browser","/enterprise-features/#test-using-minio-client":"/enterprise-features/binary-backups/#test-using-minio-client","/enterprise-features/#disabling-https-for-s3-and-minio-backups":"/enterprise-features/binary-backups/#disabling-https-for-s3-and-minio-backups","/enterprise-features/#overriding-credentials":"/enterprise-features/binary-backups/#overriding-credentials","/enterprise-features/#backup-to-nfs":"/enterprise-features/binary-backups/#backup-to-nfs","/enterprise-features/#forcing-a-full-backup":"/enterprise-features/binary-backups/#forcing-a-full-backup","/enterprise-features/#encrypted-backups":"/enterprise-features/binary-backups/#encrypted-backups","/enterprise-features/#new-flag-“encrypted”-in-manifest.json":"/enterprise-features/binary-backups/#new-flag-“encrypted”-in-manifest.json","/enterprise-features/#aes-and-chaining-with-gzip":"/enterprise-features/binary-backups/#aes-and-chaining-with-gzip","/enterprise-features/#backup":"/enterprise-features/binary-backups/#backup","/enterprise-features/#restore-from-backup":"/enterprise-features/binary-backups/#restore-from-backup","/enterprise-features/#restore-from-amazon-s3":"/enterprise-features/binary-backups/#restore-from-amazon-s3","/enterprise-features/#restore-from-minio":"/enterprise-features/binary-backups/#restore-from-minio","/enterprise-features/#restore-from-local-directory-or-nfs":"/enterprise-features/binary-backups/#restore-from-local-directory-or-nfs","/enterprise-features/#restore-and-update-timestamp":"/enterprise-features/binary-backups/#restore-and-update-timestamp","/enterprise-features/#turn-on-acls":"/enterprise-features/access-control-lists/#turn-on-acls","/enterprise-features/#set-up-acl-rules":"/enterprise-features/access-control-lists/#set-up-acl-rules","/enterprise-features/#using-graphql-admin-api":"/enterprise-features/access-control-lists/#using-graphql-admin-api","/enterprise-features/#retrieve-users-and-groups-information":"/enterprise-features/access-control-lists/#retrieve-users-and-groups-information","/enterprise-features/#using-a-graphql-tool":"/enterprise-features/access-control-lists/#using-a-graphql-tool","/enterprise-features/#access-data-using-a-client":"/enterprise-features/access-control-lists/#access-data-using-a-client","/enterprise-features/#access-data-using-the-graphql-api":"/enterprise-features/access-control-lists/#access-data-using-the-graphql-api","/enterprise-features/#reset-groot-password":"/enterprise-features/access-control-lists/#reset-groot-password","/enterprise-features/#set-up-encryption":"/enterprise-features/encryption-at-rest/#set-up-encryption","/enterprise-features/#turn-on-encryption":"/enterprise-features/encryption-at-rest/#turn-on-encryption","/enterprise-features/#turn-off-encryption":"/enterprise-features/encryption-at-rest/#turn-off-encryption","/enterprise-features/#change-encryption-key":"/enterprise-features/encryption-at-rest/#change-encryption-key","/howto/#metrics-information":"/howto/retrieving-debug-information/#metrics-information","/howto/#profiling-information":"/howto/retrieving-debug-information/#profiling-information","/howto/#cpu-profile":"/howto/retrieving-debug-information/#cpu-profile","/howto/#memory-profile":"/howto/retrieving-debug-information/#memory-profile","/howto/#block-profile":"/howto/retrieving-debug-information/#block-profile","/howto/#goroutine-stack":"/howto/retrieving-debug-information/#goroutine-stack","/howto/#example-usage":"/howto/using-debug-tool/#example-usage","/howto/#debug-tool-output":"/howto/using-debug-tool/#debug-tool-output","/howto/#key-lookup":"/howto/using-debug-tool/#key-lookup","/howto/#key-history":"/howto/using-debug-tool/#key-history","/howto/#basic-integration":"/howto/dgraph-sentry-integration/#basic-integration","/howto/#data-handling":"/howto/dgraph-sentry-integration/#data-handling","/howto/#increment-tool-output":"/howto/using-increment-tool/#increment-tool-output","/howto/#download-zip":"/howto/load-balancing-nginx/#download-zip","/howto/#start-dgraph-cluster":"/howto/load-balancing-nginx/#start-dgraph-cluster","/howto/#use-the-increment-tool-to-start-a-grpc-lb":"/howto/load-balancing-nginx/#use-the-increment-tool-to-start-a-grpc-lb","/howto/#check-logs":"/howto/load-balancing-nginx/#check-logs","/howto/#upsert-procedure":"/howto/upserts/#upsert-procedure","/howto/#upsert-block":"/howto/upserts/#upsert-block","/howto/#conflicts":"/howto/upserts/#conflicts","/howto/#schema-types-scalar-uid-and-list-uid":"/howto/migrate-dgraph-1-1/#schema-types-scalar-uid-and-list-uid","/howto/#type-system":"/howto/migrate-dgraph-1-1/#type-system","/howto/#live-loader-and-bulk-loader-command-line-flags":"/howto/migrate-dgraph-1-1/#live-loader-and-bulk-loader-command-line-flags","/howto/#http-api":"/howto/migrate-dgraph-1-1/#http-api"},urlSplit,origPath,redirectPaths=["clients","query-language","mutations","deploy","enterprise-features","howto","design-concepts"],pathSplit=document.URL.split("/");redirectPaths.includes(pathSplit[pathSplit.length-2])&&(urlSplit=pathSplit[pathSplit.length-1].split("#"),origPath="/"+pathSplit[pathSplit.length-2]+"/#"+urlSplit[1],origPath in subPaths?(loc=""+subPaths[origPath],window.location.replace(loc)):urlSplit[1]&&(loc=""+pathSplit.slice(4,pathSplit.length-1).join("/")+"/#"+urlSplit[1],window.location.replace(loc)))</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=referrer content="no-referrer-when-downgrade"><meta name=generator content="Hugo 0.113.0"><meta name=description content="In this guide, we explain the details about using Dgraph with Kubernetes, including deploying, verifying, testing, and removing single servers and clusters."><link rel=canonical href=/deploy/kubernetes/><link rel=apple-touch-icon sizes=57x57 href=/images/favicons/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/images/favicons/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/images/favicons/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/images/favicons/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/images/favicons/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/images/favicons/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/images/favicons/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/images/favicons/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/images/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/images/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/images/favicons/favicon-194x194.png sizes=194x194><link rel=icon type=image/png href=/images/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/images/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/images/favicons/manifest.json><link rel=mask-icon href=/images/favicons/safari-pinned-tab.svg color=#fe2c06><link rel="shortcut icon" href=/images/favicons/favicon.ico><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js></script>
<script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/go.min.js></script>
<script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/languages/java.min.js integrity="sha256-RyOs5MjQ+Ef9DQrPHp4QGr2tcNjxLh6mCkkW+sS4doU=" crossorigin=anonymous></script>
<script src=//code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.js integrity="sha256-x3BtPVERvw1ozPlwivuFLZoViFCeAAs1Gt6SxEedmo8=" crossorigin=anonymous></script>
<link href=//cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.css rel=stylesheet integrity="sha256-7sZe9dsqyNZC9Mk+WPRB7nVvPPPXyorzm2QKqlgXC4k=" crossorigin=anonymous><script async src=//cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/addon/edit/closebrackets.min.js integrity="sha256-qhu2a7DSpQaammMaLw1iruxBpxmgdw8mdQaQWQUokcY=" crossorigin=anonymous></script>
<script async src=//cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/mode/javascript/javascript.min.js integrity="sha256-7Bdg/UdDMmHDPafpQDYZNPCEbnRP7eAvu+2hEoqRCXs=" crossorigin=anonymous></script><title>Using Kubernetes - Deploy</title><link href=/css/theme.css?6a79ff0832398fa8541cbaef6b6dd556 rel=stylesheet><link href=/css/runnable.css?46648956d99faa2e057d109b9f2a52e6 rel=stylesheet><link href=/css/tabs.css?035edc32762cb7973b740e3067101ced rel=stylesheet><link href=//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css rel=stylesheet integrity=sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ crossorigin=anonymous><script src=//cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js integrity=sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb crossorigin=anonymous></script>
<script src=//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js integrity=sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn crossorigin=anonymous></script>
<link href="//fonts.googleapis.com/css?family=Lato:400,700" rel=stylesheet><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link href=https://cdn.lineicons.com/2.0/LineIcons.css rel=stylesheet crossorigin=anonymous><link rel=stylesheet href=//cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css><script>!function(){var t,n,e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){var n=Array.prototype.slice.call(arguments);return n.unshift(t),e.push(n),e}};for(t=0;t<e.methods.length;t++)n=e.methods[t],e[n]=e.factory(n);e.load=function(t,n){var o,s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js",o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(s,o),e._loadOptions=n},e._writeKey="aQlf725vSBKhpQnINiGBc6rCtFyVCiAP",e.SNIPPET_VERSION="4.13.2",e.load("aQlf725vSBKhpQnINiGBc6rCtFyVCiAP"),e.page(),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("a");t.forEach(t=>e.trackLink(t,"Click",{id:t.id,to:t.href,text:t.innerText}))})}}()</script></head><body><nav id=header><div class=header-left><div><a href=https://libremfg.com/features-gql class=brand><img src=/images/libre-logo.png alt=libre class=logo></a><div class=logo-tagline><span>Baas Documentation</span></div></div></div><div class=header-right><div style=margin-top:10px><div class="menu-search align-middle"><div class=menu-search-inner><input type=search class="form-control form-control-sm" id=algolia-doc-search placeholder="Search documentation" aria-label="Search docs" autocomplete=off></div></div></div><div><ul class=menu><li><a href=https://libremfg.com/features-gql target=_blank>Home</a></li><li><a href=https://www.libremfg.com/pricing-gql/ target=_blank>Pricing</a></li><li><a href=https://discord.gg/vtJ7JE4sha target=_blank>Community</a></li><li><a href=https://github.com/libremfg/libremfg.github.io target=_blank>GitHub</a></li></ul></div></div><a href=# id=sidebar-toggle><i class="fa fa-bars"></i></a></nav><aside id=sidebar><div class=menu-header></div><ul class=topics><li class="topic main-topic children"><a id=datahub href=#>DataHub</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/datahub/overview/>Overview</a></li><li class="topic sub-topic"><a href=/datahub/isa-95-data-model/>ISA 95 Data Model</a></li><li class="topic sub-topic"><a href=/datahub/streaming-data/>Streaming Data</a></li></ul></li><li class="topic main-topic"><a href=/>Home</a></li><li class="topic main-topic"><a href=/dgraph-overview/>Dgraph Overview</a></li><li class="topic main-topic children"><a id=bpmn href=#>BPMN</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=#>Events</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/bpmn/events/overview/>Events Overview</a></li><li class="topic sub-topic"><a href=/bpmn/events/message/>Message Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/timer/>Timer Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/signal/>Signal Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/escalation/>Escalation Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/error/>Error Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/conditional/>Conditional Event</a></li><li class="topic sub-topic"><a href=/bpmn/events/compensation/>Compensation Event</a></li></ul></li><li class="topic sub-topic"><a href=#>Gateways</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/bpmn/gateways/overview/>Gateway Overview</a></li><li class="topic sub-topic"><a href=/bpmn/gateways/parallel/>Parallel Gateway</a></li><li class="topic sub-topic"><a href=/bpmn/gateways/inclusive/>Inclusive Gateway</a></li><li class="topic sub-topic"><a href=/bpmn/gateways/complex/>Complex Gateway</a></li><li class="topic sub-topic"><a href=/bpmn/gateways/event-based/>Event Based Gateway</a></li></ul></li><li class="topic sub-topic"><a href=#>Tasks</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/bpmn/tasks/overview/>Tasks Overview</a></li></ul></li></ul></li><li class="topic main-topic children"><a id=graphql href=#>GraphQL</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/quick-start/>Quick Start</a></li><li class="topic sub-topic"><a href=/graphql/how-dgraph-graphql-works/>How GraphQL works in Dgraph</a></li><li class="topic sub-topic"><a href=#>To-Do List App Tutorial</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-schema-design/>Schema Design</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-ui/>Creating a Basic UI</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-auth-rules/>Authorization Rules</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-auth0-jwt/>Using Auth0</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/todo-firebase-jwt/>Using Firebase Authentication</a></li><li class="topic sub-topic"><a href=/graphql/todo-app-tutorial/deploy/>Deploying on Dgraph Cloud</a></li></ul></li><li class="topic sub-topic"><a href=#>Authorization</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/authorization/authorization-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/authorization/directive/>The @auth Directive</a></li><li class="topic sub-topic"><a href=/graphql/authorization/mutations/>Mutations</a></li></ul></li><li class="topic sub-topic"><a href=#>API</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/api/api-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/api/requests/>Requests and Responses</a></li><li class="topic sub-topic"><a href=/graphql/api/variables/>GraphQL Variables</a></li><li class="topic sub-topic"><a href=/graphql/api/fragments/>GraphQL Fragments</a></li><li class="topic sub-topic"><a href=/graphql/api/multiples/>Multiple GraphQL Operations in a Request</a></li><li class="topic sub-topic"><a href=/graphql/api/errors/>GraphQL Errors</a></li></ul></li><li class="topic sub-topic"><a href=#>Schema</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/schema/schema-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/schema/reserved/>Reserved Names</a></li><li class="topic sub-topic"><a href=/graphql/schema/migration/>Schema Migration</a></li><li class="topic sub-topic"><a href=/graphql/schema/types/>Types</a></li><li class="topic sub-topic"><a href=/graphql/schema/ids/>IDs</a></li><li class="topic sub-topic"><a href=/graphql/schema/graph-links/>Links in the Graph</a></li><li class="topic sub-topic"><a href=/graphql/schema/search/>Search and Filtering</a></li><li class="topic sub-topic"><a href=/graphql/schema/generate/>The @generate Directive</a></li><li class="topic sub-topic"><a href=/graphql/schema/documentation/>Documentation and Comments</a></li><li class="topic sub-topic"><a href=/graphql/schema/deprecated/>Deprecation</a></li><li class="topic sub-topic"><a href=/graphql/schema/dgraph-schema/>Dgraph Schema Fragment</a></li><li class="topic sub-topic"><a href=/graphql/schema/default/>@default Directive</a></li><li class="topic sub-topic"><a href=/graphql/schema/primarykey/>@primaryKey Directive</a></li></ul></li><li class="topic sub-topic"><a href=#>Queries</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/queries/queries-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/queries/search-filtering/>Search and Filtering</a></li><li class="topic sub-topic"><a href=/graphql/queries/aggregate/>Aggregate Queries</a></li><li class="topic sub-topic"><a href=/graphql/queries/persistent-queries/>Persistent Queries</a></li><li class="topic sub-topic"><a href=/graphql/queries/and-or-not/>And, Or and Not</a></li><li class="topic sub-topic"><a href=/graphql/queries/cached-results/>Cached Results</a></li><li class="topic sub-topic"><a href=/graphql/queries/order-page/>Order and Pagination</a></li><li class="topic sub-topic"><a href=/graphql/queries/cascade/>@cascade Directive</a></li><li class="topic sub-topic"><a href=/graphql/queries/skip-include/>@skip and @include Directives</a></li></ul></li><li class="topic sub-topic"><a href=#>Mutations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/mutations/mutations-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/mutations/add/>Add</a></li><li class="topic sub-topic"><a href=/graphql/mutations/upsert/>Upsert</a></li><li class="topic sub-topic"><a href=/graphql/mutations/update/>Update</a></li><li class="topic sub-topic"><a href=/graphql/mutations/delete/>Delete</a></li><li class="topic sub-topic"><a href=/graphql/mutations/deep/>Deep</a></li></ul></li><li class="topic sub-topic"><a href=/graphql/subscriptions/>Subscriptions</a></li><li class="topic sub-topic"><a href=#>Custom Resolvers</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/custom/custom-overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/custom/directive/>The @custom Directive</a></li><li class="topic sub-topic"><a href=/graphql/custom/query/>Custom Queries</a></li><li class="topic sub-topic"><a href=/graphql/custom/mutation/>Custom Mutations</a></li><li class="topic sub-topic"><a href=/graphql/custom/field/>Custom Fields</a></li><li class="topic sub-topic"><a href=/graphql/custom/dql/>Custom DQL</a></li></ul></li><li class="topic sub-topic"><a href=#>Lambda Resolvers</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/graphql/lambda/overview/>Overview</a></li><li class="topic sub-topic"><a href=/graphql/lambda/field/>Lambda Fields</a></li><li class="topic sub-topic"><a href=/graphql/lambda/query/>Lambda Queries</a></li><li class="topic sub-topic"><a href=/graphql/lambda/mutation/>Lambda Mutations</a></li><li class="topic sub-topic"><a href=/graphql/lambda/webhook/>Lambda Webhooks</a></li><li class="topic sub-topic"><a href=/graphql/lambda/server/>Lambda Server</a></li></ul></li><li class="topic sub-topic"><a href=/graphql/directives/>Directives</a></li><li class="topic sub-topic"><a href=/graphql/admin/>Administrative API</a></li><li class="topic sub-topic"><a href=/graphql/dgraph/>GraphQL on Existing Dgraph</a></li><li class="topic sub-topic"><a href=/graphql/federation/>Apollo Federation</a></li></ul></li><li class="topic main-topic children active"><a id=deploy-and-manage href=#>Deploy and Manage</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/deploy/overview/>Deployment and Management Overview</a></li><li class="topic sub-topic"><a href=/deploy/download/>Download Dgraph</a></li><li class="topic sub-topic"><a href=/deploy/config/>Configuration</a></li><li class="topic sub-topic"><a href=/deploy/dgraph-zero/>More about Dgraph Zero</a></li><li class="topic sub-topic"><a href=/deploy/dgraph-alpha/>More about Dgraph Alpha</a></li><li class="topic sub-topic"><a href=/deploy/single-host-setup/>Single Host Setup</a></li><li class="topic sub-topic"><a href=/deploy/multi-host-setup/>Multi-Host Setup</a></li><li class="topic sub-topic active"><a href=/deploy/kubernetes/>Using Kubernetes</a></li><li class="topic sub-topic"><a href=/deploy/cluster-setup/>Cluster Setup</a></li><li class="topic sub-topic"><a href=/deploy/cluster-checklist/>Cluster Checklist</a></li><li class="topic sub-topic"><a href=/deploy/production-checklist/>Production Checklist</a></li><li class="topic sub-topic"><a href=#>Administration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/deploy/dgraph-administration/>Dgraph Administration</a></li><li class="topic sub-topic"><a href=/deploy/log-format/>Logging</a></li><li class="topic sub-topic"><a href=/deploy/ludicrous-mode/>Ludicrous Mode</a></li><li class="topic sub-topic"><a href=/deploy/monitoring/>Monitoring</a></li><li class="topic sub-topic"><a href=/deploy/metrics/>Metrics</a></li><li class="topic sub-topic"><a href=/deploy/tracing/>Tracing</a></li><li class="topic sub-topic"><a href=/deploy/data-compression/>Data compression on Disk</a></li></ul></li><li class="topic sub-topic"><a href=#>Fast Data Loading</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/deploy/fast-data-loading/overview/>Overview</a></li><li class="topic sub-topic"><a href=/deploy/fast-data-loading/bulk-loader/>Bulk Loader</a></li><li class="topic sub-topic"><a href=/deploy/fast-data-loading/live-loader/>Live Loader</a></li></ul></li><li class="topic sub-topic"><a href=#>Security</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/deploy/ports-usage/>Ports Usage</a></li><li class="topic sub-topic"><a href=/deploy/tls-configuration/>TLS Configuration</a></li></ul></li><li class="topic sub-topic"><a href=/deploy/decrypt/>Data Decryption</a></li><li class="topic sub-topic"><a href=/deploy/cli-command-reference/>Dgraph CLI Reference</a></li><li class="topic sub-topic"><a href=/deploy/troubleshooting/>Troubleshooting</a></li></ul></li><li class="topic main-topic children"><a id=migration href=#>Migration</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/migration/loading-csv-data/>Loading CSV Data</a></li><li class="topic sub-topic"><a href=/migration/migrate-tool/>Migration Tool</a></li><li class="topic sub-topic"><a href=/migration/migrate-dgraph-1-1/>Migrate from Dgraph v1.0</a></li><li class="topic sub-topic"><a href=/migration/dgraph-compared-to-other-databases/>Dgraph Compared to Other Databases</a></li></ul></li><li class="topic main-topic"><a href=/faq/>FAQ</a></li><li class="topic main-topic children"><a id=how-to-guides href=#>How To Guides</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/howto/retrieving-debug-information/>Retrieving Debug Information</a></li><li class="topic sub-topic"><a href=/howto/completion/>Shell Completion</a></li><li class="topic sub-topic"><a href=/howto/using-debug-tool/>Using the Debug Tool</a></li><li class="topic sub-topic"><a href=/howto/dgraph-sentry-integration/>Using the Dgraph Sentry Integration</a></li><li class="topic sub-topic"><a href=/howto/using-increment-tool/>Using the Increment Tool</a></li><li class="topic sub-topic"><a href=/howto/giving-nodes-type/>Giving Nodes a Type</a></li><li class="topic sub-topic"><a href=/howto/login-system/>A Simple Login System</a></li><li class="topic sub-topic"><a href=/howto/load-balancing-nginx/>Load Balancing Queries with NGINX</a></li><li class="topic sub-topic"><a href=/howto/upserts/>Upserts</a></li><li class="topic sub-topic"><a href=/howto/jepsen-tests/>Run Jepsen Tests</a></li><li class="topic sub-topic"><a href=/howto/lambda-webhooks-example/>Lambda Webhooks Example</a></li></ul></li><li class="topic main-topic children"><a id=design-concepts href=#>Design Concepts</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/design-concepts/transactions-faq/>Transactions: FAQ</a></li><li class="topic sub-topic"><a href=/design-concepts/consistency-model/>Consistency Model</a></li><li class="topic sub-topic"><a href=/design-concepts/concepts/>Concepts</a></li><li class="topic sub-topic"><a href=/design-concepts/minimizing-network-calls/>How Dgraph Minimizes Network Calls</a></li><li class="topic sub-topic"><a href=/design-concepts/raft/>RAFT</a></li></ul></li><li class="topic main-topic"><a href=/releases/>Releases</a></li><li class="topic main-topic children"><a id=dql href=#>dql</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/get-started/>Get Started</a></li><li class="topic sub-topic"><a href=/tutorials/>Tutorials</a></li><li class="topic sub-topic"><a href=#>Query Language Reference</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/query-language/graphql-fundamentals/>DQL Fundamentals</a></li><li class="topic sub-topic"><a href=/query-language/functions/>Functions</a></li><li class="topic sub-topic"><a href=/query-language/connecting-filters/>Connecting Filters</a></li><li class="topic sub-topic"><a href=/query-language/alias/>Aliases</a></li><li class="topic sub-topic"><a href=/query-language/pagination/>Pagination in DQL</a></li><li class="topic sub-topic"><a href=/query-language/count/>Count</a></li><li class="topic sub-topic"><a href=/query-language/sorting/>Sorting</a></li><li class="topic sub-topic"><a href=/query-language/multiple-query-blocks/>Multiple Query Blocks</a></li><li class="topic sub-topic"><a href=/query-language/query-variables/>Query Variables</a></li><li class="topic sub-topic"><a href=/query-language/value-variables/>Value Variables</a></li><li class="topic sub-topic"><a href=/query-language/aggregation/>Aggregation</a></li><li class="topic sub-topic"><a href=/query-language/math-on-value-variables/>Math on Value Variables</a></li><li class="topic sub-topic"><a href=/query-language/groupby/>GroupBy</a></li><li class="topic sub-topic"><a href=/query-language/expand-predicates/>Expand Predicates</a></li><li class="topic sub-topic"><a href=/query-language/cascade-directive/>Cascade Directive</a></li><li class="topic sub-topic"><a href=/query-language/normalize-directive/>@normalize Directive</a></li><li class="topic sub-topic"><a href=/query-language/ignorereflex-directive/>@ignorereflex Directive</a></li><li class="topic sub-topic"><a href=/query-language/debug/>Debug</a></li><li class="topic sub-topic"><a href=/query-language/schema/>Schemas in DQL</a></li><li class="topic sub-topic"><a href=/query-language/type-system/>Type System</a></li><li class="topic sub-topic"><a href=/query-language/facets/>Facets and Edge Attributes</a></li><li class="topic sub-topic"><a href=/query-language/kshortest-path-quries/>Shortest Path Queries</a></li><li class="topic sub-topic"><a href=/query-language/recurse-query/>Recurse Query</a></li><li class="topic sub-topic"><a href=/query-language/fragments/>Fragments</a></li><li class="topic sub-topic"><a href=/query-language/graphql-variables/>GraphQL Variables</a></li><li class="topic sub-topic"><a href=/query-language/indexing-custom-tokenizers/>Indexing with Custom Tokenizers</a></li></ul></li><li class="topic sub-topic"><a href=/tips/>Tips and Tricks</a></li><li class="topic sub-topic"><a href=#>Mutations</a><div class=arrow-down></div><ul class=sub-topics><li class="topic sub-topic"><a href=/mutations/triples/>Triples</a></li><li class="topic sub-topic"><a href=/mutations/blank-nodes/>Blank Nodes and UIDs</a></li><li class="topic sub-topic"><a href=/mutations/external-ids/>External IDs</a></li><li class="topic sub-topic"><a href=/mutations/external-ids-upsert-block/>External IDs and Upsert Block</a></li><li class="topic sub-topic"><a href=/mutations/language-rdf-types/>Language and RDF Types</a></li><li class="topic sub-topic"><a href=/mutations/batch-mutations/>Batch Mutations</a></li><li class="topic sub-topic"><a href=/mutations/delete/>Delete</a></li><li class="topic sub-topic"><a href=/mutations/facets-in-list-type-with-rdf/>Facet Lists in RDF</a></li><li class="topic sub-topic"><a href=/mutations/mutations-using-curl/>Mutations Using cURL</a></li><li class="topic sub-topic"><a href=/mutations/json-mutation-format/>JSON Mutation Format</a></li><li class="topic sub-topic"><a href=/mutations/upsert-block/>Upsert Blocks</a></li><li class="topic sub-topic"><a href=/mutations/conditional-upsert/>Conditional Upsert</a></li><li class="topic sub-topic"><a href=/mutations/reverse-edges/>Reverse Edges</a></li></ul></li></ul></li></ul><ul class=sidebar-menu><li><a href=https://dgraph.io/ target=_blank>Home</a></li><li><a href=https://discuss.dgraph.io/ target=_blank>Community</a></li><li><a href=https://github.com/dgraph-io/dgraph target=_blank>GitHub</a></li></ul></aside><main class=content-wrapper><div class=content><div class=top-toc><nav id=TableOfContents><ul><li><a href=#single-server>Single Server</a><ul><li><a href=#deploy-single-server>Deploy Single Server</a></li><li><a href=#verify-single-server>Verify Single Server</a></li><li><a href=#test-single-server-setup>Test Single Server Setup</a></li><li><a href=#remove-single-server-resources>Remove Single Server Resources</a></li></ul></li><li><a href=#ha-cluster-setup-using-kubernetes>HA Cluster Setup Using Kubernetes</a><ul><li><a href=#validate-kubernetes-cluster-for-ha>Validate Kubernetes Cluster for HA</a><ul><li><a href=#deploy-dgraph-ha-cluster>Deploy Dgraph HA Cluster</a></li></ul></li><li><a href=#verify-dgraph-ha-cluster>Verify Dgraph HA Cluster</a></li><li><a href=#test-dgraph-ha-cluster-setup>Test Dgraph HA Cluster Setup</a></li><li><a href=#delete-dgraph-ha-cluster-resources>Delete Dgraph HA Cluster Resources</a></li></ul></li><li><a href=#using-helm-chart>Using Helm Chart</a><ul><li><a href=#installing-the-chart>Installing the Chart</a><ul><li><a href=#dgraph-configuration-files>Dgraph Configuration Files</a></li><li><a href=#exposing-alpha-and-ratel-services>Exposing Alpha and Ratel Services</a></li></ul></li><li><a href=#upgrading-the-chart>Upgrading the Chart</a><ul><li><a href=#upgrade-to-ha-cluster-setup>Upgrade to HA cluster setup</a></li></ul></li><li><a href=#deleting-the-chart>Deleting the Chart</a></li><li><a href=#configuration>Configuration</a></li></ul></li><li><a href=#monitoring-in-kubernetes>Monitoring in Kubernetes</a><ul><li><a href=#installation-through-manifests>Installation through Manifests</a><ul><li><a href=#install-prometheus-operator>Install Prometheus operator</a></li><li><a href=#install-prometheus>Install Prometheus</a></li><li><a href=#registering-alerts-and-installing-alert-manager>Registering Alerts and Installing Alert Manager</a></li></ul></li><li><a href=#install-using-helm-chart>Install Using Helm Chart</a></li><li><a href=#adding-dgraph-kubernetes-grafana-dashboard>Adding Dgraph Kubernetes Grafana Dashboard</a></li></ul></li><li><a href=#kubernetes-storage>Kubernetes Storage</a><ul><li><a href=#local-storage>Local storage</a></li><li><a href=#non-local-persistent-disks>Non-local persistent disks</a></li></ul></li><li><a href=#removing-a-dgraph-pod>Removing a Dgraph Pod</a></li><li><a href=#kubernetes-and-bulk-loader>Kubernetes and Bulk Loader</a></li></ul></nav></div><article><a class=question-btn target=_blank href=https://discord.com/invite/vtJ7JE4sha><i class="fa fa-question-circle"></i> Ask a Question</a><h1 class=post-title>Using Kubernetes</h1><div><p>The following section covers running Dgraph with Kubernetes. We have tested Dgraph with Kubernetes versions 1.14 to 1.16 on <a href=https://cloud.google.com/kubernetes-engine>GKE</a> and versions 1.14 to 1.17 on <a href=https://aws.amazon.com/eks/>EKS</a>.</p><div class="notices note"><span class=type>Note</span> These instructions are for running the Dgraph Alpha service without TLS configuration.
To learn how to run Dgraph Alpha with TLS, see <a href=/deploy/tls-configuration/>TLS Configuration</a>.</div><ul><li>Install <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl/>kubectl</a> which is used to deploy
and manage applications on kubernetes.</li><li>Get the Kubernetes cluster up and running on a cloud provider of your choice.<ul><li>For Amazon <a href=https://aws.amazon.com/eks/>EKS</a>, you can use <a href=https://eksctl.io/>eksctl</a> to quickly provision a new cluster. If you are new to this, Amazon has an article <a href=https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html>Getting started with eksctl</a>.</li><li>For Google Cloud <a href=https://cloud.google.com/kubernetes-engine>GKE</a>, you can use <a href=https://cloud.google.com/sdk/install>Google Cloud SDK</a> and the <code>gcloud container clusters create</code> command to quickly provision a new cluster.</li></ul></li></ul><p>Verify that you have your cluster up and running using <code>kubectl get nodes</code>. If you used <code>eksctl</code> or <code>gcloud container clusters create</code> with the default options, you should have 2-3 worker nodes ready.</p><p>On Amazon <a href=https://aws.amazon.com/eks/>EKS</a>, you would see something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>➜  kubernetes git:(master) ✗ kubectl get nodes
</span></span><span style=display:flex><span>NAME                                          STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>&lt;aws-ip-hostname&gt;.&lt;region&gt;.compute.internal   Ready    &lt;none&gt;   1m   v1.15.11-eks-af3caf
</span></span><span style=display:flex><span>&lt;aws-ip-hostname&gt;.&lt;region&gt;.compute.internal   Ready    &lt;none&gt;   1m   v1.15.11-eks-af3caf
</span></span></code></pre></div><p>On Google Cloud <a href=https://cloud.google.com/kubernetes-engine>GKE</a>, you would see something like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>➜  kubernetes git:(master) ✗ kubectl get nodes
</span></span><span style=display:flex><span>NAME                                       STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   41s   v1.14.10-gke.36
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   40s   v1.14.10-gke.36
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   41s   v1.14.10-gke.36
</span></span></code></pre></div><h2 id=single-server>Single Server</h2><p>Once your Kubernetes cluster is up, you can use <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/kubernetes/dgraph-single/dgraph-single.yaml>dgraph-single.yaml</a> to start a Zero, Alpha, and Ratel UI services.</p><h3 id=deploy-single-server>Deploy Single Server</h3><p>From your machine, run the following command to start a StatefulSet that creates a single Pod with Zero, Alpha, and Ratel UI running in it.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create --filename https://raw.githubusercontent.com/dgraph-io/dgraph/master/contrib/config/kubernetes/dgraph-single/dgraph-single.yaml
</span></span></code></pre></div><p>Output:</p><pre tabindex=0><code>service/dgraph-public created
statefulset.apps/dgraph created
</code></pre><h3 id=verify-single-server>Verify Single Server</h3><p>Confirm that the pod was created successfully.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>Output:</p><pre tabindex=0><code>NAME       READY     STATUS    RESTARTS   AGE
dgraph-0   3/3       Running   0          1m
</code></pre><div class="notices tip"><span class=type>Tip</span> You can check the logs for the containers in the pod using
<code>kubectl logs --follow dgraph-0 &lt;container_name></code>. For example, try
<code>kubectl logs --follow dgraph-0 alpha</code> for server logs.</div><h3 id=test-single-server-setup>Test Single Server Setup</h3><p>Port forward from your local machine to the pod</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl port-forward pod/dgraph-0 8080:8080
</span></span><span style=display:flex><span>kubectl port-forward pod/dgraph-0 8000:8000
</span></span></code></pre></div><p>Go to <code>http://localhost:8000</code> and verify Dgraph is working as expected.</p><h3 id=remove-single-server-resources>Remove Single Server Resources</h3><p>Delete all the resources</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl delete --filename https://raw.githubusercontent.com/dgraph-io/dgraph/master/contrib/config/kubernetes/dgraph-single/dgraph-single.yaml
</span></span><span style=display:flex><span>kubectl delete persistentvolumeclaims --selector app=dgraph
</span></span></code></pre></div><h2 id=ha-cluster-setup-using-kubernetes>HA Cluster Setup Using Kubernetes</h2><p>This setup allows you to run 3 Dgraph Alphas and 3 Dgraph Zeros. We start Zero with <code>--replicas 3</code> flag, so all data would be replicated on 3 Alphas and form 1 Alpha group.</p><div class="notices note"><span class=type>Note</span> Ideally you should have at least three worker nodes as part of your Kubernetes
cluster so that each Dgraph Alpha runs on a separate worker node.</div><h3 id=validate-kubernetes-cluster-for-ha>Validate Kubernetes Cluster for HA</h3><p>Check the nodes that are part of the Kubernetes cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><p>Output for Amazon <a href=https://aws.amazon.com/eks/>EKS</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>NAME                                          STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>&lt;aws-ip-hostname&gt;.&lt;region&gt;.compute.internal   Ready    &lt;none&gt;   1m   v1.15.11-eks-af3caf
</span></span><span style=display:flex><span>&lt;aws-ip-hostname&gt;.&lt;region&gt;.compute.internal   Ready    &lt;none&gt;   1m   v1.15.11-eks-af3caf
</span></span><span style=display:flex><span>&lt;aws-ip-hostname&gt;.&lt;region&gt;.compute.internal   Ready    &lt;none&gt;   1m   v1.15.11-eks-af3caf
</span></span></code></pre></div><p>Output for Google Cloud <a href=https://cloud.google.com/kubernetes-engine>GKE</a></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>NAME                                       STATUS   ROLES    AGE   VERSION
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   41s   v1.14.10-gke.36
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   40s   v1.14.10-gke.36
</span></span><span style=display:flex><span>gke-&lt;cluster-name&gt;-default-pool-&lt;gce-id&gt;   Ready    &lt;none&gt;   41s   v1.14.10-gke.36
</span></span></code></pre></div><p>Once your Kubernetes cluster is up, you can use <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/kubernetes/dgraph-ha/dgraph-ha.yaml>dgraph-ha.yaml</a> to start the cluster.</p><h4 id=deploy-dgraph-ha-cluster>Deploy Dgraph HA Cluster</h4><p>From your machine, run the following command to start the cluster.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl create --filename https://raw.githubusercontent.com/dgraph-io/dgraph/master/contrib/config/kubernetes/dgraph-ha/dgraph-ha.yaml
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>service/dgraph-zero-public created
</span></span><span style=display:flex><span>service/dgraph-alpha-public created
</span></span><span style=display:flex><span>service/dgraph-ratel-public created
</span></span><span style=display:flex><span>service/dgraph-zero created
</span></span><span style=display:flex><span>service/dgraph-alpha created
</span></span><span style=display:flex><span>statefulset.apps/dgraph-zero created
</span></span><span style=display:flex><span>statefulset.apps/dgraph-alpha created
</span></span><span style=display:flex><span>deployment.apps/dgraph-ratel created
</span></span></code></pre></div><h3 id=verify-dgraph-ha-cluster>Verify Dgraph HA Cluster</h3><p>Confirm that the pods were created successfully.</p><p>It may take a few minutes for the pods to come up.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get pods
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>NAME                  READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>dgraph-alpha-0        1/1     Running   0          6m24s
</span></span><span style=display:flex><span>dgraph-alpha-1        1/1     Running   0          5m42s
</span></span><span style=display:flex><span>dgraph-alpha-2        1/1     Running   0          5m2s
</span></span><span style=display:flex><span>dgraph-ratel-&lt;pod-id&gt; 1/1     Running   0          6m23s
</span></span><span style=display:flex><span>dgraph-zero-0         1/1     Running   0          6m24s
</span></span><span style=display:flex><span>dgraph-zero-1         1/1     Running   0          5m41s
</span></span><span style=display:flex><span>dgraph-zero-2         1/1     Running   0          5m6s
</span></span></code></pre></div><div class="notices tip"><span class=type>Tip</span> You can check the logs for the containers in the pod using <code>kubectl logs --follow dgraph-alpha-0</code> and <code>kubectl logs --follow dgraph-zero-0</code>.</div><h3 id=test-dgraph-ha-cluster-setup>Test Dgraph HA Cluster Setup</h3><p>Port forward from your local machine to the pod</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl port-forward service/dgraph-alpha-public 8080:8080
</span></span><span style=display:flex><span>kubectl port-forward service/dgraph-ratel-public 8000:8000
</span></span></code></pre></div><p>Go to <code>http://localhost:8000</code> and verify Dgraph is working as expected.</p><div class="notices note"><span class=type>Note</span> You can also access the service on its External IP address.</div><h3 id=delete-dgraph-ha-cluster-resources>Delete Dgraph HA Cluster Resources</h3><p>Delete all the resources</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl delete --filename https://raw.githubusercontent.com/dgraph-io/dgraph/master/contrib/config/kubernetes/dgraph-ha/dgraph-ha.yaml
</span></span><span style=display:flex><span>kubectl delete persistentvolumeclaims --selector app=dgraph-zero
</span></span><span style=display:flex><span>kubectl delete persistentvolumeclaims --selector app=dgraph-alpha
</span></span></code></pre></div><h2 id=using-helm-chart>Using Helm Chart</h2><p>Once your Kubernetes cluster is up, you can make use of the Helm chart present
<a href=https://github.com/dgraph-io/charts/>in our official helm repository here</a> to bring
up a Dgraph cluster.</p><div class="notices note"><span class=type>Note</span> The instructions below are for Helm versions >= 3.x.</div><h3 id=installing-the-chart>Installing the Chart</h3><p>To add the Dgraph helm repository:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm repo add dgraph https://charts.dgraph.io
</span></span></code></pre></div><p>To install the chart with the release name <code>my-release</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph
</span></span></code></pre></div><p>The above command will install a recent version of the Dgraph docker image. You can set the version an explicit version, such as:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --set image.tag=<span style=color:#a31515>&#34;&#34;</span>
</span></span></code></pre></div><div class="notices warning"><span class=type>Warning</span> When configuring the Dgraph image tag, be careful not to use <code>latest</code> or <code>master</code> in a production environment. These tags may have the Dgraph version change, causing a mixed-version Dgraph cluster that can lead to an outage and potential data loss.</div><h4 id=dgraph-configuration-files>Dgraph Configuration Files</h4><p>You can supply Dgraph config files (see <a href=/deploy/config/>Config</a>) for Alpha and Zero with Helm chart configuration values:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># my-config-values.yaml</span>
</span></span><span style=display:flex><span>alpha:
</span></span><span style=display:flex><span>  configFile:
</span></span><span style=display:flex><span>    config.yaml: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>      alsologtostderr: true
</span></span></span><span style=display:flex><span><span style=color:#a31515>      badger:
</span></span></span><span style=display:flex><span><span style=color:#a31515>        compression_level: 3
</span></span></span><span style=display:flex><span><span style=color:#a31515>        tables: mmap
</span></span></span><span style=display:flex><span><span style=color:#a31515>        vlog: mmap
</span></span></span><span style=display:flex><span><span style=color:#a31515>      postings: /dgraph/data/p
</span></span></span><span style=display:flex><span><span style=color:#a31515>      wal: /dgraph/data/w</span>      
</span></span><span style=display:flex><span>zero:
</span></span><span style=display:flex><span>  configFile:
</span></span><span style=display:flex><span>    config.yaml: |<span style=color:#a31515>
</span></span></span><span style=display:flex><span><span style=color:#a31515>      alsologtostderr: true
</span></span></span><span style=display:flex><span><span style=color:#a31515>      wal: /dgraph/data/zw</span>      
</span></span></code></pre></div><p>And then install with Alpha and Zero configuration using this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --values my-config-values.yaml
</span></span></code></pre></div><h4 id=exposing-alpha-and-ratel-services>Exposing Alpha and Ratel Services</h4><p>By default Zero and Alpha services are exposed only within the Kubernetes cluster as
Kubernetes service type <code>ClusterIP</code>.</p><p>In order to expose the Alpha service and Ratel service publicly you can use Kubernetes service type <code>LoadBalancer</code> or an Ingress resource.</p><h5 id=loadbalancer-public-internet>LoadBalancer (Public Internet)</h5><p>To use an external load balancer, set the service type to <code>LoadBalancer</code>.</p><div class="notices note"><span class=type>Note</span> For security purposes we recommend limiting access to any public endpoints, such as using a white list.</div><p>You can expose Alpha service to the Internet as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --set alpha.service.type=<span style=color:#a31515>&#34;LoadBalancer&#34;</span>
</span></span></code></pre></div><p>Similarly, you can expose Alpha and Ratel service to the Internet as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --set alpha.service.type=<span style=color:#a31515>&#34;LoadBalancer&#34;</span> --set ratel.service.type=<span style=color:#a31515>&#34;LoadBalancer&#34;</span>
</span></span></code></pre></div><h5 id=loadbalancer-private-internal-network>LoadBalancer (Private Internal Network)</h5><p>An external load balancer can be configured to face internally to a private subnet rather the public Internet. This way it can be accessed securely by clients on the same network, through a VPN, or from a jump server. In Kubernetes, this is often configured through service annotations by the provider. Here&rsquo;s a small list of annotations from cloud providers:</p><table><thead><tr><th>Provider</th><th>Documentation Reference</th><th>Annotation</th></tr></thead><tbody><tr><td>AWS</td><td><a href=https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html>Amazon EKS: Load Balancing</a></td><td><code>service.beta.kubernetes.io/aws-load-balancer-internal: "true"</code></td></tr><tr><td>Azure</td><td><a href=https://docs.microsoft.com/azure/aks/internal-lb>AKS: Internal Load Balancer</a></td><td><code>service.beta.kubernetes.io/azure-load-balancer-internal: "true"</code></td></tr><tr><td>Google Cloud</td><td><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing>GKE: Internal Load Balancing</a></td><td><code>cloud.google.com/load-balancer-type: "Internal"</code></td></tr></tbody></table><p>As an example, using Amazon <a href=https://aws.amazon.com/eks/>EKS</a> as the provider, you could create a Helm chart configuration values like this below:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># my-config-values.yaml</span>
</span></span><span style=display:flex><span>alpha:
</span></span><span style=display:flex><span>  service:
</span></span><span style=display:flex><span>    type: LoadBalancer
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      service.beta.kubernetes.io/aws-load-balancer-internal: <span style=color:#a31515>&#34;true&#34;</span>
</span></span><span style=display:flex><span>ratel:
</span></span><span style=display:flex><span>  service:
</span></span><span style=display:flex><span>    type: LoadBalancer
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      service.beta.kubernetes.io/aws-load-balancer-internal: <span style=color:#a31515>&#34;true&#34;</span>
</span></span></code></pre></div><p>And then expose Alpha and Ratel services privately:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --values my-config-values.yaml
</span></span></code></pre></div><h5 id=ingress-resource>Ingress Resource</h5><p>You can expose Alpha and Ratel using an <a href=https://kubernetes.io/docs/concepts/services-networking/ingress/>ingress</a> resource that can route traffic to service resources. Before using this option you may need to install an <a href=https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/>ingress controller</a> first, as is the case with <a href=https://docs.microsoft.com/azure/aks/>AKS</a> and <a href=https://aws.amazon.com/eks/>EKS</a>, while in the case of <a href=https://cloud.google.com/kubernetes-engine>GKE</a>, this comes bundled with a default ingress controller. When routing traffic based on the <code>hostname</code>, you may want to integrate an addon like <a href=https://github.com/kubernetes-sigs/external-dns>ExternalDNS</a> so that DNS records can be registered automatically when deploying Dgraph.</p><p>As an example, you can configure a single ingress resource that uses <a href=https://github.com/kubernetes/ingress-nginx>ingress-nginx</a> for Alpha and Ratel services, by creating Helm chart configuration values like this below:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:green># my-config-values.yaml</span>
</span></span><span style=display:flex><span>global:
</span></span><span style=display:flex><span>  ingress:
</span></span><span style=display:flex><span>    enabled: <span style=color:#00f>false</span>
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      kubernetes.io/ingress.class: nginx
</span></span><span style=display:flex><span>    ratel_hostname: <span style=color:#a31515>&#34;ratel.&lt;my-domain-name&gt;&#34;</span>
</span></span><span style=display:flex><span>    alpha_hostname: <span style=color:#a31515>&#34;alpha.&lt;my-domain-name&gt;&#34;</span>
</span></span></code></pre></div><p>And then expose Alpha and Ratel services through an ingress:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install my-release dgraph/dgraph --values my-config-values.yaml
</span></span></code></pre></div><p>Afterward you can run <code>kubectl get ingress</code> to see the status and access these through their hostname, such as <code>http://alpha.&lt;my-domain-name></code> and <code>http://ratel.&lt;my-domain-name></code></p><div class="notices tip"><span class=type>Tip</span> Ingress controllers will likely have an option to configure access for private internal networks. Consult documentation from the ingress controller provider for further information.</div><h3 id=upgrading-the-chart>Upgrading the Chart</h3><p>You can update your cluster configuration by updating the configuration of the
Helm chart. Dgraph is a stateful database that requires some attention on
upgrading the configuration carefully in order to update your cluster to your
desired configuration.</p><p>In general, you can use <a href=https://helm.sh/docs/helm/helm_upgrade/><code>helm upgrade</code></a> to update the
configuration values of the cluster. Depending on your change, you may need to
upgrade the configuration in multiple steps following the steps below.</p><h4 id=upgrade-to-ha-cluster-setup>Upgrade to HA cluster setup</h4><p>To upgrade to an <a href=#ha-cluster-setup-using-kubernetes>HA cluster setup</a>, ensure
that the shard replication setting is more than 1. When <code>zero.shardReplicaCount</code>
is not set to an HA configuration (3 or 5), follow the steps below:</p><ol><li>Set the shard replica flag on the Zero node group. For example: <code>zero.shardReplicaCount=3</code>.</li><li>Next, run the Helm upgrade command to restart the Zero node group:<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm upgrade my-release dgraph/dgraph [options]
</span></span></code></pre></div></li><li>Now set the Alpha replica count flag. For example: <code>alpha.replicaCount=3</code>.</li><li>Finally, run the Helm upgrade command again:<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm upgrade my-release dgraph/dgraph [options]
</span></span></code></pre></div></li></ol><h3 id=deleting-the-chart>Deleting the Chart</h3><p>Delete the Helm deployment as normal</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm delete my-release
</span></span></code></pre></div><p>Deletion of the StatefulSet doesn&rsquo;t cascade to deleting associated PVCs. To delete them:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl delete pvc --selector release=my-release
</span></span></code></pre></div><h3 id=configuration>Configuration</h3><p>The latest configuration settings can be found:</p><ul><li><a href=https://github.com/dgraph-io/charts/blob/master/charts/dgraph/README.md#configuration>https://github.com/dgraph-io/charts/blob/master/charts/dgraph/README.md#configuration</a></li></ul><h2 id=monitoring-in-kubernetes>Monitoring in Kubernetes</h2><p>Dgraph exposes Prometheus metrics to monitor the state of various components involved in the cluster, including Dgraph Alpha and Zero nodes.</p><p>Below are instructions to setup Prometheus monitoring for your cluster. This solution has the following parts:</p><ul><li><a href=https://coreos.com/blog/the-prometheus-operator.html>prometheus-operator</a> - a Kubernetes operator to install and configure Prometheus and Alert Manager.</li><li><a href=https://prometheus.io/>Prometheus</a> - the service that will scrape Dgraph for metrics</li><li><a href=https://prometheus.io/docs/alerting/latest/alertmanager/>AlertManager</a> - the service that will trigger alerts to a service (Slack, PagerDuty, etc) that you specify based on metrics exceeding threshold specified in Alert rules.</li><li><a href=https://grafana.com/>Grafana</a> - optional visualization solution that will use Prometheus as a source to create dashboards.</li></ul><h3 id=installation-through-manifests>Installation through Manifests</h3><p>Follow the below mentioned steps to setup Prometheus monitoring for your cluster.</p><h4 id=install-prometheus-operator>Install Prometheus operator</h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply --filename https://raw.githubusercontent.com/coreos/prometheus-operator/release-0.34/bundle.yaml
</span></span></code></pre></div><p>Ensure that the instance of <code>prometheus-operator</code> has started before continuing.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl get deployments prometheus-operator
</span></span><span style=display:flex><span>NAME                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>prometheus-operator   1         1         1            1           3m
</span></span></code></pre></div><h4 id=install-prometheus>Install Prometheus</h4><ul><li>Apply Prometheus manifest present <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/prometheus.yaml>here</a>.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl apply --filename prometheus.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>serviceaccount/prometheus-dgraph-io created
</span></span><span style=display:flex><span>clusterrole.rbac.authorization.k8s.io/prometheus-dgraph-io created
</span></span><span style=display:flex><span>clusterrolebinding.rbac.authorization.k8s.io/prometheus-dgraph-io created
</span></span><span style=display:flex><span>servicemonitor.monitoring.coreos.com/alpha.dgraph-io created
</span></span><span style=display:flex><span>servicemonitor.monitoring.coreos.com/zero-dgraph-io created
</span></span><span style=display:flex><span>prometheus.monitoring.coreos.com/dgraph-io created
</span></span></code></pre></div><p>To view Prometheus UI locally run:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl port-forward prometheus-dgraph-io-0 9090:9090
</span></span></code></pre></div><p>The UI is accessible at port 9090. Open http://localhost:9090 in your browser to play around.</p><h4 id=registering-alerts-and-installing-alert-manager>Registering Alerts and Installing Alert Manager</h4><p>To register alerts from Dgraph cluster with your Prometheus deployment, follow the steps below:</p><ul><li>Create a Kubernetes secret containing alertmanager configuration. Edit the configuration file present <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/alertmanager-config.yaml>here</a>
with the required receiver configuration including the slack webhook credential and create the secret.</li></ul><p>You can find more information about alertmanager configuration <a href=https://prometheus.io/docs/alerting/configuration/>here</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl create secret generic alertmanager-alertmanager-dgraph-io <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>    --from-file=alertmanager.yaml=alertmanager-config.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl get secrets
</span></span><span style=display:flex><span>NAME                                            TYPE                 DATA   AGE
</span></span><span style=display:flex><span>alertmanager-alertmanager-dgraph-io             Opaque               1      87m
</span></span></code></pre></div><ul><li>Apply the <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/alertmanager.yaml>alertmanager</a> along with <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/alert-rules.yaml>alert-rules</a> manifest
to use the default configured alert configuration. You can also add custom rules based on the metrics exposed by Dgraph cluster similar to <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/alert-rules.yaml>alert-rules</a>
manifest.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ kubectl apply --filename alertmanager.yaml
</span></span><span style=display:flex><span>alertmanager.monitoring.coreos.com/alertmanager-dgraph-io created
</span></span><span style=display:flex><span>service/alertmanager-dgraph-io created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ kubectl apply --filename alert-rules.yaml
</span></span><span style=display:flex><span>prometheusrule.monitoring.coreos.com/prometheus-rules-dgraph-io created
</span></span></code></pre></div><h3 id=install-using-helm-chart>Install Using Helm Chart</h3><p>There are Helm chart values that will install Prometheus, Alert Manager, and Grafana.</p><p>You will first need to add the <code>prometheus-operator</code> Helm chart:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm repo add stable https://kubernetes-charts.storage.googleapis.com
</span></span></code></pre></div><p>Afterward you will want to copy the Helm chart values present <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/prometheus/chart-values/dgraph-prometheus-operator.yaml>here</a> and edit them as appropriate, such as adding endpoints, adding alert rules, adjusting alert manager configuration, adding Grafana dashboard, etc.</p><p>Once ready, install this with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm install my-prometheus-release <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --values dgraph-prometheus-operator.yaml <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --set grafana.adminPassword=<span style=color:#a31515>&#39;&lt;put-secret-password-here&gt;&#39;</span> <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  stable/prometheus-operator
</span></span></code></pre></div><p><strong>NOTE</strong>: For security best practices, we want to keep secrets, such as the Grafana password outside of general configuration, so that it is not accidentally checked into anywhere. You can supply it through the command line, or create a separate <code>secrets.yaml</code> that is never checked into a code repository:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>grafana:
</span></span><span style=display:flex><span>  adminPassword: &lt;put-secret-password-here&gt;
</span></span></code></pre></div><p>Then you can install this in a similar fashion:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ helm install my-prometheus-release <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --values dgraph-prometheus-operator.yaml <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  --values secrets.yaml <span style=color:#a31515>\
</span></span></span><span style=display:flex><span><span style=color:#a31515></span>  stable/prometheus-operator
</span></span></code></pre></div><h3 id=adding-dgraph-kubernetes-grafana-dashboard>Adding Dgraph Kubernetes Grafana Dashboard</h3><p>You can use the Grafana dashboard present <a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/monitoring/grafana/dgraph-kubernetes-grafana-dashboard.json>here</a>. You can import this dashboard and select the Prometheus data source installed earlier.</p><p>This will visualize all Dgraph Alpha and Zero Kubernetes Pods, using the regex pattern <code>"/dgraph-.*-[0-9]*$/</code>. This can be changed by through the dashboard configuration and selecting the variable Pod. This might be desirable when you have had multiple releases, and only want to visualize the current release. For example, if you installed a new release <code>my-release-3</code> with the <a href=https://github.com/dgraph-io/charts/>Dgraph helm chart</a>, you can change the regex pattern to <code>"/my-release-3.*dgraph-.*-[0-9]*$/"</code> for the Pod variable.</p><h2 id=kubernetes-storage>Kubernetes Storage</h2><p>The Kubernetes configurations in the previous sections were configured to run
Dgraph with any storage type (<code>storage-class: anything</code>). On the common cloud
environments like AWS, GCP, and Azure, the default storage type are slow disks
like hard disks or low IOPS SSDs. We highly recommend using faster disks for
ideal performance when running Dgraph.</p><h3 id=local-storage>Local storage</h3><p>The AWS storage-optimized i-class instances provide locally attached NVMe-based
SSD storage which provide consistent very high IOPS. The Dgraph team uses
i3.large instances on AWS to test Dgraph.</p><p>You can create a Kubernetes <code>StorageClass</code> object to provision a specific type
of storage volume which you can then attach to your Dgraph pods. You can set up
your cluster with local SSDs by using <a href=https://kubernetes.io/blog/2018/04/13/local-persistent-volumes-beta/>Local Persistent
Volumes</a>.
This Kubernetes feature is in beta at the time of this writing (Kubernetes
v1.13.1). You can first set up an EC2 instance with locally attached storage.
Once it is formatted and mounted properly, then you can create a StorageClass to
access it.:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: storage.k8s.io/v1
</span></span><span style=display:flex><span>kind: StorageClass
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: &lt;your-local-storage-class-name&gt;
</span></span><span style=display:flex><span>provisioner: kubernetes.io/no-provisioner
</span></span><span style=display:flex><span>volumeBindingMode: WaitForFirstConsumer
</span></span></code></pre></div><p>Currently, Kubernetes does not allow automatic provisioning of local storage. So
a PersistentVolume with a specific mount path should be created:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: PersistentVolume
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: &lt;your-local-pv-name&gt;
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  capacity:
</span></span><span style=display:flex><span>    storage: 475Gi
</span></span><span style=display:flex><span>  volumeMode: Filesystem
</span></span><span style=display:flex><span>  accessModes:
</span></span><span style=display:flex><span>  - ReadWriteOnce
</span></span><span style=display:flex><span>  persistentVolumeReclaimPolicy: Delete
</span></span><span style=display:flex><span>  storageClassName: &lt;your-local-storage-class-name&gt;
</span></span><span style=display:flex><span>  local:
</span></span><span style=display:flex><span>    path: /data
</span></span><span style=display:flex><span>  nodeAffinity:
</span></span><span style=display:flex><span>    required:
</span></span><span style=display:flex><span>      nodeSelectorTerms:
</span></span><span style=display:flex><span>      - matchExpressions:
</span></span><span style=display:flex><span>        - key: kubernetes.io/hostname
</span></span><span style=display:flex><span>          operator: In
</span></span><span style=display:flex><span>          values:
</span></span><span style=display:flex><span>          - &lt;node-name&gt;
</span></span></code></pre></div><p>Then, in the StatefulSet configuration you can claim this local storage in
.spec.volumeClaimTemplate:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>kind: StatefulSet
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span> volumeClaimTemplates:
</span></span><span style=display:flex><span>  - metadata:
</span></span><span style=display:flex><span>      name: datadir
</span></span><span style=display:flex><span>    spec:
</span></span><span style=display:flex><span>      accessModes:
</span></span><span style=display:flex><span>      - ReadWriteOnce
</span></span><span style=display:flex><span>      storageClassName: &lt;your-local-storage-class-name&gt;
</span></span><span style=display:flex><span>      resources:
</span></span><span style=display:flex><span>        requests:
</span></span><span style=display:flex><span>          storage: 500Gi
</span></span></code></pre></div><p>You can repeat these steps for each instance that&rsquo;s configured with local
node storage.</p><h3 id=non-local-persistent-disks>Non-local persistent disks</h3><p>EBS volumes on AWS and PDs on GCP are persistent disks that can be configured
with Dgraph. The disk performance is much lower than locally attached storage
but can be sufficient for your workload such as testing environments.</p><p>When using EBS volumes on AWS, we recommend using Provisioned IOPS SSD EBS
volumes (the io1 disk type) which provide consistent IOPS. The available IOPS
for AWS EBS volumes is based on the total disk size. With Kubernetes, you can
request io1 disks to be provisioned with this config with 50 IOPS/GB using the
<code>iopsPerGB</code> parameter:</p><pre tabindex=0><code>kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: &lt;your-storage-class-name&gt;
provisioner: kubernetes.io/aws-ebs
parameters:
  type: io1
  iopsPerGB: &#34;50&#34;
  fsType: ext4
</code></pre><p>Example: Requesting a disk size of 250Gi with this storage class would provide
12.5K IOPS.</p><h2 id=removing-a-dgraph-pod>Removing a Dgraph Pod</h2><p>In the event that you need to completely remove a pod (e.g., its disk got
corrupted and data cannot be recovered), you can use the <code>/removeNode</code> API to
remove the node from the cluster. With a Kubernetes StatefulSet, you&rsquo;ll need to
remove the node in this order:</p><ol><li>On the Zero leader, call <code>/removeNode</code> to remove the Dgraph instance from
the cluster (see <a href=/deploy/dgraph-zero/>More about Dgraph Zero</a>). The removed instance will immediately stop
running. Any further attempts to join the cluster will fail for that instance
since it has been removed.</li><li>Remove the PersistentVolumeClaim associated with the pod to delete its data.
This prepares the pod to join with a clean state.</li><li>Restart the pod. This will create a new PersistentVolumeClaim to create new
data directories.</li></ol><p>When an Alpha pod restarts in a replicated cluster, it will join as a new member
of the cluster, be assigned a group and an unused index from Zero, and receive
the latest snapshot from the Alpha leader of the group.</p><p>When a Zero pod restarts, it must join the existing group with an unused index
ID. You set the index ID with the <code>--raft</code> superflag&rsquo;s <code>idx</code> option. This might
require you to update the StatefulSet configuration.</p><h2 id=kubernetes-and-bulk-loader>Kubernetes and Bulk Loader</h2><p>You may want to initialize a new cluster with an existing data set such as data
from the <a href=/deploy/fast-data-loading/bulk-loader/>Dgraph Bulk Loader</a>. You can use <a href=https://kubernetes.io/docs/concepts/workloads/pods/init-containers/>Init
Containers</a>
to copy the data to the pod volume before the Alpha process runs.</p><p>See the <code>initContainers</code> configuration in
<a href=https://github.com/dgraph-io/dgraph/blob/master/contrib/config/kubernetes/dgraph-ha/dgraph-ha.yaml>dgraph-ha.yaml</a>
to learn more.</p></div><div class=post__comments><footer class=clearfix><a class=question-btn target=_blank href=https://discord.com/invite/vtJ7JE4sha><i class="fa fa-question-circle"></i> Ask a Question</a>
<a class=edit-btn target=_blank href=https://github.com/libremfg/libremfg.github.io/issues><i class="fa fa-github-alt"></i> Edit Page</a></footer></div></article><div class=right-toc><nav id=TableOfContents><ul><li><a href=#single-server>Single Server</a><ul><li><a href=#deploy-single-server>Deploy Single Server</a></li><li><a href=#verify-single-server>Verify Single Server</a></li><li><a href=#test-single-server-setup>Test Single Server Setup</a></li><li><a href=#remove-single-server-resources>Remove Single Server Resources</a></li></ul></li><li><a href=#ha-cluster-setup-using-kubernetes>HA Cluster Setup Using Kubernetes</a><ul><li><a href=#validate-kubernetes-cluster-for-ha>Validate Kubernetes Cluster for HA</a><ul><li><a href=#deploy-dgraph-ha-cluster>Deploy Dgraph HA Cluster</a></li></ul></li><li><a href=#verify-dgraph-ha-cluster>Verify Dgraph HA Cluster</a></li><li><a href=#test-dgraph-ha-cluster-setup>Test Dgraph HA Cluster Setup</a></li><li><a href=#delete-dgraph-ha-cluster-resources>Delete Dgraph HA Cluster Resources</a></li></ul></li><li><a href=#using-helm-chart>Using Helm Chart</a><ul><li><a href=#installing-the-chart>Installing the Chart</a><ul><li><a href=#dgraph-configuration-files>Dgraph Configuration Files</a></li><li><a href=#exposing-alpha-and-ratel-services>Exposing Alpha and Ratel Services</a></li></ul></li><li><a href=#upgrading-the-chart>Upgrading the Chart</a><ul><li><a href=#upgrade-to-ha-cluster-setup>Upgrade to HA cluster setup</a></li></ul></li><li><a href=#deleting-the-chart>Deleting the Chart</a></li><li><a href=#configuration>Configuration</a></li></ul></li><li><a href=#monitoring-in-kubernetes>Monitoring in Kubernetes</a><ul><li><a href=#installation-through-manifests>Installation through Manifests</a><ul><li><a href=#install-prometheus-operator>Install Prometheus operator</a></li><li><a href=#install-prometheus>Install Prometheus</a></li><li><a href=#registering-alerts-and-installing-alert-manager>Registering Alerts and Installing Alert Manager</a></li></ul></li><li><a href=#install-using-helm-chart>Install Using Helm Chart</a></li><li><a href=#adding-dgraph-kubernetes-grafana-dashboard>Adding Dgraph Kubernetes Grafana Dashboard</a></li></ul></li><li><a href=#kubernetes-storage>Kubernetes Storage</a><ul><li><a href=#local-storage>Local storage</a></li><li><a href=#non-local-persistent-disks>Non-local persistent disks</a></li></ul></li><li><a href=#removing-a-dgraph-pod>Removing a Dgraph Pod</a></li><li><a href=#kubernetes-and-bulk-loader>Kubernetes and Bulk Loader</a></li></ul></nav></div></div></main><div class="modal fade" id=runnable-modal tabindex=-1 role=dialog aria-labelledby=exampleModalLabel aria-hidden=true><a href=# data-dismiss=modal class=modal-close-btn>Close</a><div class=modal-dialog role=document><div class=modal-content><div class=modal-body></div></div></div></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js></script>
<script type=text/javascript>if(window.docsearch){var version="latest",path=window.location.pathname,arr=/(?:\/)?((?:master)|(?:v[0-9][^/]+))(?:\/)?.*$/.exec(path);arr!=null&&arr.length>1&&(version=arr[1]),window.docsearch({apiKey:"fe4cbc1640c6c87bbc5f099902d86f97",indexName:"dgraph",inputSelector:"#algolia-doc-search",algoliaOptions:{filters:`version:${version}`},debug:!1})}</script><script type=text/javascript>adroll_adv_id="L42C3U2UXBBPVAMISVXVLC",adroll_pix_id="MOR4VUNPK5B2LHEZ2NNTDX",adroll_version="2.0",function(e,t,n,s,o){e.__adroll_loaded=!0,e.adroll=e.adroll||[],e.adroll.f=["setProperties","identify","track"];var i="https://s.adroll.com/j/"+adroll_adv_id+"/roundtrip.js";for(o=0;o<e.adroll.f.length;o++)e.adroll[e.adroll.f[o]]=e.adroll[e.adroll.f[o]]||function(t){return function(){e.adroll.push([t,arguments])}}(e.adroll.f[o]);n=t.createElement("script"),s=t.getElementsByTagName("script")[0],n.async=1,n.src=i,s.parentNode.insertBefore(n,s)}(window,document),adroll.track("pageView")</script><script src=/js/clipboard.min.js></script>
<script src=/js/dgraph.js?a9873668f1334ff6c49d4edea0a4bc38></script>
<script src=/js/runnable.js?6e7f328df4134d18ba5c8dd11f84deb8></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>